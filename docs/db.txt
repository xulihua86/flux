-- 用户
create table user (
	userid bigint(20) not null auto_increment,
	mobile varchar(11) not null comment '手机',
	account bigint(10) comment '用户帐户',
	add_sum bigint(10) comment '收入', 
	sub_sum	bigint(10) comment '支出',
	logo varchar(256) comment '头像(可设置为json)',
	nickname varchar(64),
	industry varchar(128),
	gender int(1) comment '0 女 1 男 2 保密',
	year int(8) comment '出生年岁',
	signature varchar(255) comment '签名',
	create_time bigint(20) comment '创建时间',
	PRIMARY KEY (userid),
	UNIQUE unique_1 (mobile)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 帐户明细
create table account_log(
	log_id bigint(20) not null auto_increment,
	userid bigint(20) not null,
	addorsub int(1) not null comment '增减(0 减  1增)',
	num bigint(20) not null comment '增减数量',
	create_time bigint(20) not null comment '发生时间',
	descn varchar(255) comment '描述',
	PRIMARY KEY (log_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- userid + yyyymmdd 唯一
create table sign (
	sign_id  bigint(20) not null auto_increment,
	user_id	bigint(20) not null,
	yyyymm int(6) not null comment '签到月份',
	yyyymmdd int(8) not null comment '签到日期',
	create_time bigint(20) not null comment '时间',
	PRIMARY KEY (sign_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- 奖品池配置
create table prize_pool (
	pool_id bigint(10) not null auto_increment,
	sum_num bigint(10) not null comment '投放奖金总和',
	consumed bigint(10) not null comment '已消费',
	daily_max bigint(10) not null comment '每天最多消费',
	every_max bigint(10) not null comment '每次最双消费',
	PRIMARY KEY (pool_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- 出库情况
create table prize_out(
	our_id varchar(64) not null comment 'uuid',
	userid bigint(20) not null, 
	sum_num	 bigint(20) not null comment '出池数据',
	out_num bigint(20) comment '奖品被抽走数量之和',
	out_time bigint(20) comment '奖品抽走时间',
	return_num	bigint(20) comment '归还数量',
	return_time bigint(20) comment '归还时间(由系统定时计算，3点计算前一天抽奖情况)  sum = out + return',
	PRIMARY KEY (our_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 抽奖活动结果   (该中奖属于某一次出库，多条记录属于一次出库)
create table prize_detail (
	detail_id bigint(20) not null auto_increment,
	our_id varchar(64) not null comment '属于那次出库',
	userid bigint(20) not null,
	flow_num bigint(20) not null comment '抽中的奖品数  flow_num *n  == out_num',
	create_time bigint(20) not null comment '中奖时间',
	is_receive int(1) not null comment '0 未领取 1 领取',
	receive_time bigint(20) comment '领取时间',
	PRIMARY KEY (detail_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- 约会类型
create table appointment_type(
	type_id	bigint(20) not null,
	name varchar(256) not null comment '类型名称',
	template varchar(256) not null comment '模版 ？？',
	PRIMARY KEY (type_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- 约会   (?? 企业约？？)
create table appointment(
	appointment_id bigint(20) not null auto_increment,
	userid bigint(20) not null comment '发起约会人',
	type_id	bigint(20) not null comment '约会类型',
	name varchar(255) not null comment '约会名称',
	logo varchar(256) comment '约会logo',
	target_num bigint(20) not null comment '目标人数',
	begin_time	bigint(20) not null comment '开始时间',
	end_time bigint(20) not null comment '结束时间',
	standard varchar(255) comment '奖励标准',
	declaration varchar(255) comment '宣言',
	flux_num bigint(20) not null comment '流量币',
	only_friend int(1) not null comment '仅朋友可见（0 否， 1 是)',
	push_friend int(1) not null comment '是否向朋友推送(0 不， 1是)',
	enroll_num bigint(20) not null default 0 comment '已报名人数',
	enroll_userids text comment '已报名的人的userid组合，由逗号分隔(X)',
	view_num bigint(20) not null default 0 comment '查年人数',
	create_time bigint(20) not null comment '发布时间',
	status int(1) not null comment '活动状态 ( -1 未开始， 0 进行中  1 已结束',
	PRIMARY KEY (appointment_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- 我发起的：我发起的所有约会活动
-- 我报名：是我报名参与的所有约会活动。
-- 我关注：是我关注的所有约会活动。
-- 参与过：是我报名过的，但活动已结束了的。
create table partake_appointment(
	partake_id	bigint(20) not null auto_increment,
	appointment_id bigint(20) not null,  
	userid bigint(20) not null,
	type int(1) not null comment '(0 报名 1 关注)',
	create_time bigint(20) not null comment '报名的时间',
	PRIMARY KEY  (partake_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- 好友关注(我关注的朋友)  可用redis的sortSet结构存储
create table flower(
	userid bigint(20) not null auto_increment comment '第一人称' ,
	friend_id bigint(20) not null comment '关注的人',
	create_time bigint(20) not null comment '关注时间',
	PRIMARY KEY  (userid)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- 我的消息(共有哪些消息?)
create table message(
	msg_id bigint(20) not null auto_increment,
	userid bigint(20) not null,
	type int(1) not null comment '1 朋友转赠',
	num  bigint(20),
	template varchar(256), 
	status int(1) not null comment '当type 为 1时， 0 未领取 1 已领取',
	create_time bigint(20) not null,
	PRIMARY KEY  (msg_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
 
 
 -- 我的步迹
create table trace_log(
	log_id bigint(20) not null auto_increment,
	userid bigint(20) not null,
	descn varchar(255) not null,
	create_time bigint(20) not null,
	PRIMARY KEY  (log_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- 任务配置池
create table task(
	task_id	bigint(20) not null auto_increment,
	name varchar(64) not null,
	code bigint(20)	not null comment '任务编号',
	descn text comment '任务流程， 规则等',
	reward_num bigint(10) not null comment '完成任务奖励的流量币',
	PRIMARY KEY  (task_id),
	UNIQUE unique_1 (code)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- 如何发起一项任务？？
create table my_task(
	my_task_id	bigint(20) not null auto_increment,
	userid	bigint(20) not null,
	task_id	bigint(20) not null, 
	reward_num bigint(10) not null comment '完成任务奖励的流量币',
	status int(1) not null comment '完成任务后，流量币的领取情况  0 未领取 1 领取',
	create_time bigint(20) not null comment '入库时间',
	receive_time bigint(20) not null comment '领取时间',
	PRIMARY KEY  (my_task_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- 流量币交易 (不做)
create table trade(
	trade_id	bigint(20) not null auto_increment,
	type	int(1) not null,   -- 交易类型
	
	
	PRIMARY KEY  (trade_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- 商城产品
create table shop_goods(
	goods_id bigint(20) not null auto_increment,
	name varchar(64) not null comment '产品名',
	logo varchar(128) not null comment '产品logo',
	descn text comment '产品描述',
	type	int(1) not null comment '0 流量币购买， 1 现金购买',
	price	decimal(10,2) not null comment '价格，以元为单位，精确到2位小数',
	stock  bigint(20)		not null comment '库存',
	sold   bigint(20)		not null comment '已售出',
	PRIMARY KEY  (goods_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 订单
create table orders(
	order_id bigint(20) not null auto_increment,
	userid bigint(20) not null,
	price decimal(10,2) not null comment '总价',
	goods_id	bigint(20) not null comment '商品id',
	create_time bigint(20) not null comment '加入时间',
	pay_status int(1) not null comment '0 未支付 1 已支付 2 支付失败',
	pay_time bigint(20) not null comment '支付时间',
	PRIMARY KEY  (order_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 订单明细(不需要)
create table order_item(
	item_id bigint(20) not null auto_increment,
	userid bigint(20) not null comment '购买者',
	order_id bigint(20) not null,
	goods_id bigint(20) not null,
	price decimal(10,2) not null comment '商品价格购买时价格',
	create_time bigint(20) not null comment '加入时间',
	PRIMARY KEY  (item_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;

 -- 支付日志
create table pay_log(
	log_id bigint(20) not null auto_increment,
	tran_no	varchar(64),
	order_id bigint(20) not null,
	status int(1) not null,
	create_time bigint(20) not null,
	PRIMARY KEY  (log_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


-- https://github.com/beecloud/beecloud-java/releases
-- 微支付 https://beecloud.cn/